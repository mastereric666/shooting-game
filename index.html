<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>射擊遊戲</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas {
            border: 2px solid white;
            background-color: #000;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // 遊戲變數
        let player;
        let bullets = [];
        let enemies = [];
        let score = 0;
        let lives = 3;
        let gameOver = false;
        let difficulty = 1;

        // 按鍵狀態
        let keys = {
            left: false,
            right: false,
            space: false
        };

        // 遊戲音效
        const shootSound = new Audio('shoot.mp3');
        const explosionSound = new Audio('explosion.mp3');

        // 玩家物件
        function Player() {
            this.x = canvas.width / 2 - 25;
            this.y = canvas.height - 50;
            this.width = 50;
            this.height = 30;
            this.speed = 5;
            this.draw = function() {
                ctx.fillStyle = "blue";
                ctx.fillRect(this.x, this.y, this.width, this.height);
            };
            this.move = function() {
                if (keys.left && this.x > 0) this.x -= this.speed;
                if (keys.right && this.x < canvas.width - this.width) this.x += this.speed;
            };
            this.shoot = function() {
                if (keys.space) {
                    bullets.push(new Bullet(this.x + this.width / 2 - 2.5, this.y, 5));
                    shootSound.play();
                }
            };
        }

        // 子彈物件
        function Bullet(x, y, speed) {
            this.x = x;
            this.y = y;
            this.width = 5;
            this.height = 10;
            this.speed = speed;
            this.draw = function() {
                ctx.fillStyle = "white";
                ctx.fillRect(this.x, this.y, this.width, this.height);
            };
            this.update = function() {
                this.y -= this.speed;
            };
        }

        // 敵人物件
        function Enemy() {
            this.x = Math.random() * (canvas.width - 30);
            this.y = -30;
            this.width = 30;
            this.height = 30;
            this.speed = difficulty;
            this.draw = function() {
                ctx.fillStyle = "red";
                ctx.fillRect(this.x, this.y, this.width, this.height);
            };
            this.update = function() {
                this.y += this.speed;
            };
        }

        // 碰撞檢測
        function checkCollision(bullet, enemy) {
            return bullet.x < enemy.x + enemy.width &&
                   bullet.x + bullet.width > enemy.x &&
                   bullet.y < enemy.y + enemy.height &&
                   bullet.y + bullet.height > enemy.y;
        }

        // 初始化遊戲
        function init() {
            player = new Player();
            gameLoop();
            document.addEventListener("keydown", keyDownHandler);
            document.addEventListener("keyup", keyUpHandler);
        }

        // 鍵盤按鍵處理
        function keyDownHandler(e) {
            if (e.key === "ArrowLeft") keys.left = true;
            if (e.key === "ArrowRight") keys.right = true;
            if (e.key === " ") keys.space = true;
        }

        function keyUpHandler(e) {
            if (e.key === "ArrowLeft") keys.left = false;
            if (e.key === "ArrowRight") keys.right = false;
            if (e.key === " ") keys.space = false;
        }

        // 遊戲主循環
        function gameLoop() {
            if (gameOver) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            player.move();
            player.shoot();
            player.draw();

            // 更新子彈
            for (let i = 0; i < bullets.length; i++) {
                bullets[i].update();
                bullets[i].draw();

                // 碰撞檢測
                for (let j = 0; j < enemies.length; j++) {
                    if (checkCollision(bullets[i], enemies[j])) {
                        score += 1;
                        enemies.splice(j, 1);
                        bullets.splice(i, 1);
                        explosionSound.play();
                        break;
                    }
                }
            }

            // 更新敵人
            if (Math.random() < 0.02 * difficulty) {
                enemies.push(new Enemy());
            }
            for (let i = 0; i < enemies.length; i++) {
                enemies[i].update();
                enemies[i].draw();

                if (enemies[i].y > canvas.height - 30) {
                    lives -= 1;
                    enemies.splice(i, 1);
                    if (lives <= 0) {
                        gameOver = true;
                        displayGameOver();
                    }
                }
            }

            // 顯示分數和生命
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, 10, 20);
            ctx.fillText("Lives: " + lives, canvas.width - 100, 20);

            // 增加難度
            if (score % 10 === 0 && score !== 0) {
                difficulty += 0.1;
            }

            requestAnimationFrame(gameLoop);
        }

        // 顯示遊戲結束畫面
        function displayGameOver() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "red";
            ctx.font = "40px Arial";
            ctx.fillText("Game Over", canvas.width / 2 - 100, canvas.height / 2);
            ctx.font = "20px Arial";
            ctx.fillText("Final Score: " + score, canvas.width / 2 - 50, canvas.height / 2 + 40);
        }

        // 開始遊戲
        init();
    </script>
</body>
</html>
